# 보팅 임계치 기반 보상 감액 시스템

## 개요

보팅 임계치 기반 보상 감액 메커니즘은 블록체인 네트워크 초기 단계에서 실사용자가 적을 때 과도한 보상이 지급되는 것을 방지하기 위해 설계되었습니다. 이 기능은 네트워크 전체의 총 보팅 파워가 지정된 임계치 미만일 때 컨텐츠 보상을 비례적으로 감액하며, 감액된 부분은 모든 이해관계자에게 공정하게 분배되도록 베스팅 풀에 추가됩니다.

## 동기

블록체인 네트워크 출시 초기 단계에서는 소수의 사용자가 제한된 보팅 파워로 성숙한 네트워크를 위해 설계된 보상 풀에서 불균형적으로 큰 보상을 가져갈 수 있습니다. 이는 다음과 같은 문제를 야기합니다:

1. **불공정한 보상 배분** - 적은 보팅 활동으로 성숙한 네트워크 수준의 전체 보상을 받음
2. **경제적 불균형** - 초기 사용자가 최소한의 지분 참여로 과도한 가치를 추출할 수 있음
3. **네트워크 건전성** - 보상은 실제 네트워크 참여도와 사용량을 반영해야 함

이 메커니즘은 실제 네트워크 참여도에 비례하여 보상을 조정함으로써 이러한 문제를 해결합니다.

## 메커니즘

### 계산 프로세스

매 블록마다 다음 계산이 수행됩니다:

1. **총 보팅 파워 계산**
   - 현재 블록의 보상 풀에서 보상을 받을 모든 포스트/댓글의 rshares 합산

2. **네트워크 참여 비율 계산**
   ```
   참여_비율 = 총_보팅_rshares / (전체_네트워크_VESTS × 임계치_비율)
   ```

   여기서:
   - `총_보팅_rshares` = 보상 받을 컨텐츠의 모든 보팅 가중치(rshares) 합계
   - `전체_네트워크_VESTS` = 전체 네트워크의 총 VESTS
   - `임계치_비율` = 요구되는 참여 임계치 (체인 파라미터)

3. **감액 계수 적용**
   ```
   if 참여_비율 >= 1.0:
       감액_계수 = 1.0  // 감액 없음, 전체 보상 지급
   else:
       감액_계수 = 참여_비율  // 비례 감액
   ```

4. **보상 배분**
   ```
   실제_컨텐츠_보상 = 원래_보상 × 감액_계수
   베스팅_풀_보너스 = 원래_보상 × (1 - 감액_계수)
   ```

### 예시 시나리오

#### 시나리오 1: 제네시스 런칭 - 임계치 미만
```
전체 네트워크 VESTS: 1,000,000
임계치 비율: 100% (1.0)
요구 보팅 파워: 1,000,000 VESTS (네트워크의 100%)
실제 보팅 파워: 300,000 VESTS (30%만 참여)

참여_비율 = 300,000 / 1,000,000 = 0.3
감액_계수 = 0.3

원래 컨텐츠 보상: 100 STEEM
실제 컨텐츠 보상: 30 STEEM (30%)
베스팅 풀 보너스: 70 STEEM (70%)

결과: 컨텐츠가 30% 보상 수령, 베스팅 풀이 70% 수령
```

#### 시나리오 2: 초기 성장기 - 점진적 완화
```
전체 네트워크 VESTS: 100,000,000
임계치 비율: 10% (0.1)
요구 보팅 파워: 10,000,000 VESTS
실제 보팅 파워: 15,000,000 VESTS

참여_비율 = 15,000,000 / 10,000,000 = 1.5
감액_계수 = 1.0 (최대 1.0으로 제한)

결과: 컨텐츠가 100% 보상 수령, 베스팅 풀 보너스 없음
```

#### 시나리오 3: 성숙한 네트워크 - 최소 임계치
```
전체 네트워크 VESTS: 10,000,000,000
임계치 비율: 0.5% (0.005)
요구 보팅 파워: 50,000,000 VESTS
실제 보팅 파워: 80,000,000 VESTS

참여_비율 = 80,000,000 / 50,000,000 = 1.6
감액_계수 = 1.0 (최대 1.0으로 제한)

결과: 컨텐츠가 100% 보상 수령, 베스팅 풀 보너스 없음
```

## 구현 세부사항

### 체인 파라미터

임계치를 제어하기 위한 새로운 체인 파라미터가 도입됩니다:

- **`percent_network_voting_threshold`** - 전체 보상을 받기 위해 보팅에 참여해야 하는 전체 네트워크 VESTS의 비율
  - 타입: `uint16_t` (베이시스 포인트, 예: 10000 = 100%)
  - 기본값: 10000 (제네시스 런칭 시 100%)
  - 수정 방법: 하드포크 또는 증인 합의
  - 참고: 네트워크가 성숙함에 따라 점진적으로 감소시켜야 함

### 코드 위치

구현은 여러 핵심 컴포넌트의 수정을 포함합니다:

1. **프로토콜 레이어** (`src/core/protocol/`)
   - 체인 파라미터 정의 추가
   - 보상 계산 구조체 업데이트

2. **체인 레이어** (`src/core/chain/database.cpp`)
   - `process_funds()`의 보상 배분 로직 수정
   - 총 보팅 파워 및 참여 비율 계산
   - 컨텐츠 보상에 감액 계수 적용
   - 감액된 부분을 베스팅 풀에 추가

### 데이터베이스 오브젝트

다음 오브젝트들이 관련됩니다:

- **`dynamic_global_property_object`** - 총 VESTS 및 베스팅 풀 잔액 추적
- **`comment_object`** - 각 포스트/댓글의 rshares 포함
- **`reward_fund_object`** - 보상 풀 배분 관리

## 경제적 영향

### 장점

1. **초기 단계 경제 보호** - 네트워크가 작을 때 보상 악용 방지
2. **모든 이해관계자에게 공정한 배분** - 감액된 보상이 베스팅 풀로 이동하여 모든 VESTS 보유자에게 비례적으로 혜택
3. **유기적 성장 장려** - 실제 네트워크 사용량에 따라 보상이 자연스럽게 조정됨
4. **보팅 참여 인센티브** - 이해관계자들이 컨텐츠 큐레이션에 적극적으로 참여하도록 동기 부여
5. **장기적 정렬** - 베스팅 풀 보너스가 장기 보유 및 네트워크 기여를 장려

### 트레이드오프

1. **초기 작가 보상 감소** - 낮은 활동 기간 동안 컨텐츠 제작자가 적은 보상 수령
2. **복잡성** - 보상 계산에 계산 오버헤드 추가
3. **파라미터 민감도** - 임계치 설정이 신중한 조정 필요

## 설정

### 노드 운영자용

특별한 설정은 필요하지 않습니다. 메커니즘은 하드포크를 통해 활성화되면 합의 규칙에 의해 자동으로 적용됩니다.

### 증인용

증인은 표준 체인 파라미터 업데이트 프로세스를 통해 임계치 파라미터 변경을 제안할 수 있습니다.

네트워크 단계별 권장 임계치 값:
- **제네시스 런칭**: 전체 VESTS의 100% (초기에는 모든 지분이 보팅에 참여해야 함)
- **부트스트랩 단계**: 공급량이 부트스트랩 임계치까지 증가함에 따라 100%에서 1%로 선형 감소
- **초기 성장기**: 전체 VESTS의 1% - 10% (점진적으로 완화)
- **성숙한 네트워크**: 전체 VESTS의 0.1% - 1% 또는 비활성화 고려 (0으로 설정)

## 활성화

이 기능은 제네시스 런칭부터 활성화됩니다. 초기 설정은 다음과 같습니다:

1. 임계치 파라미터가 제네시스 블록 설정에 포함됨
2. 기본 임계치 비율: 10000 (100% - 초기에는 전체 네트워크 참여 요구)
3. 네트워크가 성장함에 따라 증인 합의를 통해 임계치를 점진적으로 감소시켜야 함

## 모니터링

노드 운영자와 증인은 다음을 모니터링해야 합니다:

1. **현재 참여 비율** - API 또는 로그를 통해
2. **적용된 감액 계수** - 보상이 감액되는 빈도 추적
3. **베스팅 풀 보너스 누적** - 베스팅 풀에 추가된 보상

API를 통해 노출할 권장 메트릭:
```json
{
  "voting_threshold_info": {
    "total_network_vests": "1000000000.000000 VESTS",
    "total_voting_rshares": "500000000000",
    "percent_network_voting_threshold": 10000,
    "participation_ratio": 0.5,
    "current_reduction_factor": 0.5,
    "blocks_below_threshold": 1234,
    "total_rewards_to_vesting_pool": "50000.000 STEEM"
  }
}
```

## 테스팅

### 유닛 테스트

필수 테스트 커버리지:
- 다양한 참여 비율에서의 보상 계산
- 임계치 경계 조건 (정확히 임계치에서, 바로 위/아래)
- 베스팅 풀 보너스 배분
- 기존 보상 펀드 로직과의 통합

### 통합 테스트

- 보상 감액을 포함한 전체 블록 처리
- 단일 블록 내 여러 포스트/댓글
- 임계치 경계 전환
- 하드포크 활성화

## 향후 고려사항

1. **동적 임계치 조정** - 네트워크 성장 메트릭에 기반한 자동 조정
2. **단계별 감액 곡선** - 부드러운 전환을 위한 비선형 스케일링
3. **태그별 임계치** - 다른 컨텐츠 카테고리에 대한 다른 요구사항
4. **시간 기반 감쇠** - 네트워크가 성숙함에 따라 메커니즘을 점진적으로 단계적 폐지

## 참고자료

- [보상 배분 알고리즘](../../technical-reference/reward-distribution.md)
- [증인 스케줄링](../../technical-reference/witness-scheduling.md)
- [체인 파라미터](../../technical-reference/chain-parameters.md)

## 버전 히스토리

- **버전 1.0** - 초기 명세 (2025-11-08)
